angular.module("rzTable",[]),angular.module("rzTable").directive("rzTable",["resizeStorage","$injector",function(t,n){function e(){}function o(t,n,e){R=n,D=t.container?$(t.container):$(R).parent(),$(R).addClass("resize"),l(R,e,t),i(R,e,t),a(R,e,t),u(R,e,t),r(R,e,t)}function r(t,n,e){e.$watch("profile",function(o,r){c(t),l(t,n,e)})}function i(t,n,e){void 0!==e.bind&&(e.bind={update:function(){c(t),l(t,n,e)}})}function u(t,n,e){e.$watch(function(){return $(t).find("th").length},function(){c(t),l(t,n,e)})}function a(t,n,e){e.$watch(function(){return e.mode},function(){c(t),l(t,n,e)})}function c(t){W=!0,s(t)}function s(t){$(t).find("th").find(".handle").remove()}function l(n,e,o){C=$(n).find("th"),w=o.mode,z=!angular.isDefined(o.saveTableSizes)||o.saveTableSizes,g=o.profile;var r=m(o,e);r&&(M=new r(n,C,D),z&&(x=t.loadTableSizes(n,o.mode,o.profile)),S=M.handles(C),T=M.ctrlColumns,M.setup(),y(x),S.each(function(t,e){d(n,e)}))}function d(t,n){var e=$("<div>",{"class":"handle"});$(n).prepend(e);var o=M.handleMiddleware(e,n);f(t,e,o)}function f(t,n,e){$(n).mousedown(function(t){W&&(M.onFirstDrag(e,n),M.onTableReady(),W=!1);var o={};M.intervene&&(o=M.intervene.selector(e),o.column=o,o.orgWidth=$(o).width()),t.preventDefault(),$(n).addClass("active"),$("body").addClass("table-resize");var r=t.clientX,i=$(e).width();$(window).mousemove(h(e,r,i,o)),$(window).one("mouseup",v(n))})}function h(t,n,e,o){return function(r){var i=r.clientX,u=i-n,a=M.calculate(e,u);if(!(a<p(t)||M.restrict(a,u))){if(M.intervene){var c=M.intervene.calculator(o.orgWidth,u);if(c<p(o.column))return;if(M.intervene.restrict(c,u))return;$(o.column).width(c)}$(t).width(a)}}}function p(t){return parseInt($(t).css("min-width"))||0}function m(t,e){try{var o=e.mode?t.mode:"BasicResizer",r=n.get(o);return r}catch(i){return console.error("The resizer "+t.mode+" was not found"),null}}function v(t){return function(){$(t).removeClass("active"),$(window).unbind("mousemove"),$("body").removeClass("table-resize"),M.onEndDrag(),b()}}function b(){z&&(x||(x={}),$(C).each(function(t,n){var e=angular.element(n).scope(),o=e.colName||$(n).attr("id");o&&(x[o]=M.saveAttr(n))}),t.saveTableSizes(R,w,g,x))}function y(t){t&&($(R).width("auto"),T.each(function(n,e){var o=angular.element(e).scope(),r=o.colName||$(e).attr("id"),i=t[r];$(e).css({width:i})}),M.onTableReady())}var w,z,g,C=null,T=null,S=null,R=null,D=null,M=null,W=!0,x=null;return{restrict:"A",link:o,controller:e,controllerAs:"rzctrl",scope:{mode:"=rzMode",profile:"=?rzProfile",saveTableSizes:"=?rzSave",bind:"=rzBind",container:"@rzContainer"}}}]),angular.module("rzTable").directive("rzCol",[function(){function t(t,n,e){t.colName=t.$eval(e.resizeCol)}return{restrict:"A",link:t,require:"^^rzTable",scope:!0}}]),angular.module("rzTable").service("resizeStorage",["$window",function(t){function n(t,n,o){var r=t.attr("id");return r?e+"."+t.attr("id")+"."+n+(o?"."+o:""):void console.error("Table has no id",t)}var e="ngColumnResize";this.loadTableSizes=function(e,o,r){var i=n(e,o,r),u=t.localStorage.getItem(i);return JSON.parse(u)},this.saveTableSizes=function(e,o,r,i){var u=n(e,o,r);if(u){var a=JSON.stringify(i);t.localStorage.setItem(u,a)}}}]),angular.module("rzTable").factory("ResizerModel",[function(){function t(t,n,e){this.table=t,this.columns=n,this.container=e,this.handleColumns=this.handles(),this.ctrlColumns=this.ctrlColumns()}return t.prototype.setup=function(){$(this.container).css({overflowX:"hidden"})},t.prototype.onTableReady=function(){$(this.table).outerWidth("100%")},t.prototype.getMinWidth=function(t){return parseInt($(t).css("min-width"))||0},t.prototype.handles=function(){return this.columns},t.prototype.ctrlColumns=function(){return this.handleColumns},t.prototype.onFirstDrag=function(){$(this.ctrlColumns).each(function(t,n){$(n).width($(n).width())})},t.prototype.handleMiddleware=function(t,n){return n},t.prototype.restrict=function(t){return!1},t.prototype.calculate=function(t,n){return t+n},t.prototype.onEndDrag=function(){},t.prototype.saveAttr=function(t){return $(t).outerWidth()},t}]),angular.module("rzTable").factory("BasicResizer",["ResizerModel",function(t){function n(n,i,u){t.call(this,n,i,u),this.ctrlColumns=this.columns,this.intervene={selector:e,calculator:o,restrict:r}}function e(t){return $(t).next()}function o(t,n){return t-n}function r(t){return t<25}return n.prototype=Object.create(t.prototype),n.prototype.setup=function(){$(this.container).css({overflowX:"hidden"}),$(this.table).css({width:"100%"})},n.prototype.handles=function(){return $(this.columns).not(":last")},n.prototype.onFirstDrag=function(){this.onEndDrag()},n.prototype.onEndDrag=function(){var t=$(this.table).outerWidth(),n=[];$(this.columns).each(function(e,o){var r=$(o).outerWidth(),i=r/t*100+"%";n.push(function(){$(o).css({width:i})})}),n.map(function(t){t()})},n.prototype.saveAttr=function(t){return $(t)[0].style.width},n}]),angular.module("rzTable").factory("FixedResizer",["ResizerModel",function(t){function n(n,e,o){t.call(this,n,e,o),this.fixedColumn=$(n).find("th").first(),this.bound=!1}return n.prototype=Object.create(t.prototype),n.prototype.setup=function(){$(this.container).css({overflowX:"hidden"}),$(this.table).css({width:"100%"}),$(this.columns).first().css({width:"auto"})},n.prototype.handles=function(){return $(this.columns).not(":last")},n.prototype.ctrlColumns=function(){return $(this.columns).not(":first")},n.prototype.onFirstDrag=function(){$(this.ctrlColumns).each(function(t,n){$(n).width($(n).width())})},n.prototype.handleMiddleware=function(t,n){return $(n).next()},n.prototype.restrict=function(t,n){return this.bound&&this.bound<n?(this.bound=!1,!1):!!(this.bound&&this.bound>n)||(this.fixedColumn.width()<=this.getMinWidth(this.fixedColumn)?(this.bound=n,$(this.fixedColumn).width(this.minWidth),!0):void 0)},n.prototype.onEndDrag=function(){this.bound=!1},n.prototype.calculate=function(t,n){return t-n},n}]),angular.module("rzTable").factory("OverflowResizer",["ResizerModel",function(t){function n(n,e,o){t.call(this,n,e,o)}return n.prototype=Object.create(t.prototype),n.prototype.setup=function(){$(this.container).css({overflow:"auto"})},n.prototype.onTableReady=function(){$(this.table).width(1)},n}]);