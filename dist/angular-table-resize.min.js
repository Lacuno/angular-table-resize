angular.module("rzTable",[]),angular.module("rzTable").directive("rzTable",["resizeStorage","$injector","$parse",function(t,e,n){function o(t){}function r(t,e,n){D=e,W=t.container?$(t.container):$(D).parent(),$(D).addClass("resize"),f(D,n,t),u(D,n,t),s(D,n,t),a(D,n,t)}function i(t,e,n){return function(o,r){r!==o&&(l(t),f(t,e,n))}}function a(t,e,n){n.$watch("profile",i(t,e,n)),n.$watch("mode",i(t,e,n))}function s(t,e,n){n.$watch(function(){return $(t).find("th").length},i(t,e,n))}function u(e,o,r){if(o.rzModel){var i=n(o.rzModel);i.assign(r.$parent,{update:function(){l(e),f(e,o,r)},reset:function(){c(e),this.clearStorageActive(),this.update()},clearStorage:function(){t.clearAll()},clearStorageActive:function(){t.clearCurrent(e,w,S)}})}}function l(t){I=!0,d(t)}function c(t){$(t).outerWidth("100%"),$(t).find("th").width("auto")}function d(t){$(t).find("th").find(".handle").remove()}function f(e,n,o){T=$(e).find("th"),w=o.mode,C=!angular.isDefined(o.saveTableSizes)||o.saveTableSizes,S=o.profile,o.options=n.rzOptions?o.options||{}:{};var r=z(o,n);r&&(A=new r(e,T,W),C&&(O=t.loadTableSizes(e,o.mode,o.profile)),M=A.handles(T),R=A.ctrlColumns,A.setup(),g(O),M.each(function(t,n){h(o,e,n)}))}function h(t,e,n){var o=$("<div>",{"class":"handle"});$(n).prepend(o);var r=A.handleMiddleware(o,n);p(t,e,o,r)}function p(t,e,n,o){$(n).mousedown(function(e){I&&(A.onFirstDrag(o,n),A.onTableReady(),I=!1),t.options.onResizeStarted&&t.options.onResizeStarted(o);var r={};A.intervene&&(r=A.intervene.selector(o),r.column=r,r.orgWidth=$(r).width()),e.preventDefault(),$(n).addClass("active"),$("body").addClass("table-resize");var i=e.clientX,a=$(o).width();$(window).mousemove(m(t,o,i,a,r)),$(window).one("mouseup",y(t,o,n))})}function m(t,e,n,o,r){return function(i){var a=i.clientX,s=a-n,u=A.calculate(o,s);if(!(u<v(e)||A.restrict(u,s))){if(A.intervene){var l=A.intervene.calculator(r.orgWidth,s);if(l<v(r.column))return;if(A.intervene.restrict(l,s))return;$(r.column).width(l)}t.options.onResizeInProgress&&t.options.onResizeInProgress(e,u,s),$(e).width(u)}}}function v(t){return parseInt($(t).css("min-width"))||0}function z(t,n){try{var o=n.rzMode?t.mode:"BasicResizer",r=e.get(o);return r}catch(i){return console.error("The resizer "+t.mode+" was not found"),null}}function y(t,e,n){return function(){$(n).removeClass("active"),$(window).unbind("mousemove"),$("body").removeClass("table-resize"),t.options.onResizeEnded&&t.options.onResizeEnded(e),A.onEndDrag(),b()}}function b(){C&&(O||(O={}),$(T).each(function(t,e){var n=angular.element(e).scope(),o=n.rzCol||$(e).attr("id");o&&(O[o]=A.saveAttr(e))}),t.saveTableSizes(D,w,S,O))}function g(t){t&&($(D).width("auto"),R.each(function(e,n){var o=angular.element(n).scope(),r=o.rzCol||$(n).attr("id"),i=t[r];$(n).css({width:i})}),A.onTableReady())}var w,C,S,T=null,R=null,M=null,D=null,W=null,A=null,I=!0,O=null;return o.$inject=["$scope","$attrs","$element"],{restrict:"A",link:r,controller:o,scope:{mode:"=rzMode",profile:"=?rzProfile",saveTableSizes:"=?rzSave",options:"=?rzOptions",model:"=rzModel",container:"@rzContainer"}}}]),angular.module("rzTable").directive("rzCol",[function(){function t(t,e,n){t.rzCol=t.$eval(n.rzCol)}return{restrict:"A",priority:650,link:t,require:"^^rzTable",scope:!0}}]),angular.module("rzTable").service("resizeStorage",["$window",function(t){function e(t,e,o){var r=t.attr("id");return r?n+"."+t.attr("id")+"."+e+(o?"."+o:""):void console.error("Table has no id",t)}var n="ngColumnResize";this.loadTableSizes=function(n,o,r){var i=e(n,o,r),a=t.localStorage.getItem(i);return JSON.parse(a)},this.saveTableSizes=function(n,o,r,i){var a=e(n,o,r);if(a){var s=JSON.stringify(i);t.localStorage.setItem(a,s)}},this.clearAll=function(){for(var e=[],o=0;o<t.localStorage.length;++o){var r=localStorage.key(o);r&&r.startsWith(n)&&e.push(r)}e.map(function(e){t.localStorage.removeItem(e)})},this.clearCurrent=function(n,o,r){var i=e(n,o,r);i&&t.localStorage.removeItem(i)}}]),angular.module("rzTable").factory("ResizerModel",[function(){function t(t,e,n){this.table=t,this.columns=e,this.container=n,this.handleColumns=this.handles(),this.ctrlColumns=this.ctrlColumns()}return t.prototype.setup=function(){$(this.container).css({overflowX:"hidden"})},t.prototype.onTableReady=function(){$(this.table).outerWidth("100%")},t.prototype.getMinWidth=function(t){return parseInt($(t).css("min-width"))||0},t.prototype.handles=function(){return this.columns},t.prototype.ctrlColumns=function(){return this.handleColumns},t.prototype.onFirstDrag=function(){$(this.ctrlColumns).each(function(t,e){$(e).width($(e).width())})},t.prototype.handleMiddleware=function(t,e){return e},t.prototype.restrict=function(t){return!1},t.prototype.calculate=function(t,e){return t+e},t.prototype.onEndDrag=function(){},t.prototype.saveAttr=function(t){return $(t).outerWidth()},t}]),angular.module("rzTable").factory("BasicResizer",["ResizerModel",function(t){function e(e,i,a){t.call(this,e,i,a),this.ctrlColumns=this.columns,this.intervene={selector:n,calculator:o,restrict:r}}function n(t){return $(t).next()}function o(t,e){return t-e}function r(t){return t<25}return e.prototype=Object.create(t.prototype),e.prototype.setup=function(){$(this.container).css({overflowX:"hidden"}),$(this.table).css({width:"100%"})},e.prototype.handles=function(){return $(this.columns).not(":last")},e.prototype.onFirstDrag=function(){this.onEndDrag()},e.prototype.onEndDrag=function(){var t=$(this.table).outerWidth(),e=[];$(this.columns).each(function(n,o){var r=$(o).outerWidth(),i=r/t*100+"%";e.push(function(){$(o).css({width:i})})}),e.map(function(t){t()})},e.prototype.saveAttr=function(t){return $(t)[0].style.width},e}]),angular.module("rzTable").factory("FixedResizer",["ResizerModel",function(t){function e(e,n,o){t.call(this,e,n,o),this.fixedColumn=$(e).find("th").first(),this.bound=!1}return e.prototype=Object.create(t.prototype),e.prototype.setup=function(){$(this.container).css({overflowX:"hidden"}),$(this.table).css({width:"100%"}),$(this.columns).first().css({width:"auto"})},e.prototype.handles=function(){return $(this.columns).not(":last")},e.prototype.ctrlColumns=function(){return $(this.columns).not(":first")},e.prototype.onFirstDrag=function(){$(this.ctrlColumns).each(function(t,e){$(e).width($(e).width())})},e.prototype.handleMiddleware=function(t,e){return $(e).next()},e.prototype.restrict=function(t,e){return this.bound&&this.bound<e?(this.bound=!1,!1):!!(this.bound&&this.bound>e)||(this.fixedColumn.width()<=this.getMinWidth(this.fixedColumn)?(this.bound=e,$(this.fixedColumn).width(this.minWidth),!0):void 0)},e.prototype.onEndDrag=function(){this.bound=!1},e.prototype.calculate=function(t,e){return t-e},e}]),angular.module("rzTable").factory("OverflowResizer",["ResizerModel",function(t){function e(e,n,o){t.call(this,e,n,o)}return e.prototype=Object.create(t.prototype),e.prototype.setup=function(){$(this.container).css({overflow:"auto"})},e.prototype.onTableReady=function(){$(this.table).width(1)},e}]);